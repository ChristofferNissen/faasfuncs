sudo: required

arch:
  - arm64
os: linux

jobs:
    include:
      - os: linux
        arch: arm64

services:
  - docker

language: python3

matrix:
    include:
        - os: linux
          arch: arm64
          compiler: gcc
          env: CONFIG_OPTS="--strict-warnings"

cache: yarn

before_install:
  # installing newer docker
  # architecture
  - sudo dpkg --add-architecture armhf
  - dpkg --print-architecture
  - dpkg --print-foreign-architectures

  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-ce:armhf

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then

    # installing the faas-cli
    - curl -sSL https://cli.openfaas.com | sudo sh
    - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    - faas-cli build -f cstest.yml
    
    - faas-cli push -f c  stest.yml
    - faas-cli login --username admin --password="$OPENFAAS_PASS" -g http://christoffernissen.me:8080
    - faas-cli deploy -f cstest.yml
    fi
  # you can deploy to a dev or prod (whatever) environment at this stage
